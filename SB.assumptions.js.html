<script>

    $(document).ready(function(){
        $('.tabs').tabs();
    });

    $('#editConstructionBtn').click(function(e) {
        e.preventDefault();
        $('#displayConstructionBtns').hide();
        $('#editConstructionBtns').show();
        $('.construction-display').hide();
        $('.construction-edit').show();
    });

    $('#editConstructionCancelBtn').click(function(e) {
        e.preventDefault();
        $('#displayConstructionBtns').show();
        $('#editConstructionBtns').hide();
        $('.construction-display').show();
        $('.construction-edit').hide();
    });


    $('#editRevenueBtn').click(function(e) {
        e.preventDefault();
        $('#displayRevenueBtns').hide();
        $('#editRevenueBtns').show();
        $('.revenue-display').hide();
        $('.revenue-edit').show();
    });

    $('#editRevenueCancelBtn').click(function(e) {
        e.preventDefault();
        $('#displayRevenueBtns').show();
        $('#editRevenueBtns').hide();
        $('.revenue-display').show();
        $('.revenue-edit').hide();
    });

    $('#editLoanBtn').click(function(e) {
        e.preventDefault();
        $('#displayLoanBtns').hide();
        $('#editLoanBtns').show();
        $('.loan-display').hide();
        $('.loan-edit').show();
    });

    $('#editLoanCancelBtn').click(function(e) {
        e.preventDefault();
        $('#displayLoanBtns').show();
        $('#editLoanBtns').hide();
        $('.loan-display').show();
        $('.loan-edit').hide();
    });

        $('#editExpenseBtn').click(function(e) {
        e.preventDefault();
        $('#displayExpenseBtns').hide();
        $('#editExpenseBtns').show();
        $('.expense-display').hide();
        $('.expense-edit').show();
    });

    $('#editExpenseCancelBtn').click(function(e) {
        e.preventDefault();
        $('#displayExpenseBtns').show();
        $('#editExpenseBtns').hide();
        $('.expense-display').show();
        $('.expense-edit').hide();
    });

    $('#addExpenseBtn').click(function() {
        addExpenseModal.open();
    });

    $('#deleteExpenseBtn').click(function() {
        deleteExpenseModal.open();
    });

    $('#expenseCategory').change(function() {
    });

    $('#editExpenseSaveBtn').click(function(e) {

        e.preventDefault();
        $(this).text('saving...');
        var expenses={},temp=[],val='',displayVal='',type='';
        expenses.land = [];
        expenses.hardCosts = [];
        expenses.softCosts = [];

        // get land values
        $('#land li').each(function() {
            temp = [];
            $(this).find('.land-expense').each(function() {
                type = $(this).attr('type');
                val = $(this).val();
                if (type == 'number') displayVal = formatNumber(val);
                else displayVal = val;
                $(this).prev().text(displayVal)
                if (!val) val = '';
                temp.push(val);
            });
            expenses.land.push(temp);
        });

        // get hard cost values
        $('#hardCosts li').each(function() {
            temp = [];
            $(this).find('.hard-cost-expense' ).each(function() {
                type = $(this).attr('type');
                val = $(this).val();
                if (type == 'number') displayVal = formatNumber(val);
                else displayVal = val;
                $(this).prev().text(displayVal)
                if (!val) val = '';
                temp.push(val);
            });
            expenses.hardCosts.push(temp);
        });

        // get soft cost values
        $('#softCosts li').each(function() {
            temp = [];
            $(this).find('.soft-cost-expense' ).each(function() {
                type = $(this).attr('type');
                val = $(this).val();
                if (type == 'number') displayVal = formatNumber(val);
                else displayVal = val;
                $(this).prev().text(displayVal)
                if (!val) val = '';
                temp.push(val);
            });
            expenses.softCosts.push(temp);
        });

        google.script.run.withUserObject(this).withSuccessHandler(successSaveExpenses).saveExpenses(expenses);
    });

    $('#editRevenueSaveBtn').click(function(e) {
        e.preventDefault();
        $(this).text('saving...');
        var revenue={},temp=[],val='',displayVal='',type='';

        //get sales values
        revenue.sales = [];
        $('#revenueSales li').each(function() {
            temp = [];
            $(this).find('.sales-revenue').each(function() {
                type = $(this).attr('type');
                val = $(this).val();
                if (!val) val = '';
                var percent = $(this).data('percent');
                if (percent) {
                    if (val) {
                        displayVal = val * 100 + "%";
                    } else {
                        displayVal = '';
                    }
                } else if (type == 'number') {
                    displayVal = formatNumber(val);
                } else {
                    displayVal = val;
                }
                $(this).prev().text(displayVal)
                if (!val) val = '';
                temp.push(val);
            });
            revenue.sales.push(temp);
        });

        //get earnest money values
        revenue.earnestMoney = [];
        $('#revenueEarnestMoney li').each(function() {
            temp = [];

            $(this).find('.earnest-money-revenue').each(function() {

                type = $(this).attr('type');
                val = $(this).val();
                if (!val) val = '';
                var percent = $(this).data('percent');
                if (percent) {
                    if (val) {
                        displayVal = val * 100 + "%";
                    } else {
                        displayVal = '';
                    }
                } else if (type == 'number') {
                    displayVal = formatNumber(val);
                } else {
                    displayVal = val;
                }
                $(this).prev().text(displayVal)
                if (!val) val = '';
                temp.push(val);

            });
            revenue.earnestMoney.push(temp);
        });
        google.script.run.withUserObject(this).withSuccessHandler(successSaveRevenue).saveRevenue(revenue);
    });

    $('#editLoanSaveBtn').click(function(e) {
        e.preventDefault();
        $(this).text('saving...');
        var loans={},temp=[],val='',displayVal='',type='';

        // acquisition
        loans.acquisition = [];
        $('#loansAcquisition li').each(function() {
            temp = [];
            $(this).find('.acquisition-loans').each(function() {
                type = $(this).attr('type');
                val = $(this).val();
                if (!val) val = '';
                var percent = $(this).data('percent');
                if (percent) {
                    if (val) {
                        displayVal = val * 100 + "%";
                    } else {
                        displayVal = '';
                    }
                } else if (type == 'number') {
                    displayVal = formatNumber(val);
                } else {
                    displayVal = val;
                }
                $(this).prev().text(displayVal)
                if (!val) val = '';
                temp.push(val);
            });
            loans.acquisition.push(temp);
        });

        // construction
        loans.construction = [];
        $('#loansConstruction li').each(function() {
            temp = [];

            $(this).find('.construction-loans').each(function() {

                type = $(this).attr('type');
                val = $(this).val();
                if (!val) val = '';
                var percent = $(this).data('percent');
                if (percent) {
                    if (val) {
                        displayVal = val * 100 + "%";
                    } else {
                        displayVal = '';
                    }
                } else if (type == 'number') {
                    displayVal = formatNumber(val);
                } else {
                    displayVal = val;
                }
                $(this).prev().text(displayVal)
                if (!val) val = '';
                temp.push(val);

            });
            loans.construction.push(temp);
        });

        // construction
        loans.loanFees = [];
        $('#loansFees li').each(function() {
            temp = [];
            $(this).find('.fees-loans').each(function() {
                type = $(this).attr('type');
                val = $(this).val();
                if (!val) val = '';
                var percent = $(this).data('percent');
                if (percent) {
                    if (val) {
                        displayVal = val * 100 + "%";
                    } else {
                        displayVal = '';
                    }
                } else if (type == 'number') {
                    displayVal = formatNumber(val);
                } else {
                    displayVal = val;
                }
                $(this).prev().text(displayVal)
                if (!val) val = '';
                temp.push(val);
            });
            loans.loanFees.push(temp);
        });
        google.script.run.withUserObject(this).withSuccessHandler(successSaveLoans).saveLoans(loans);
    });

    $('#editConstructionSaveBtn').click(function(e){
        e.preventDefault();
        $(this).text('saving...');
        var construction={},temp=[],val='',displayVal='',type='';

        //get condominium values
        construction.condominiums = [];
        $('#constructionCondominiums li').each(function() {
            temp = [];
            $(this).find('.condominiums-construction').each(function() {
                type = $(this).attr('type');
                val = $(this).val();
                if (!val) val = '';
                var percent = $(this).data('percent');
                if (percent) {
                    if (val) {
                        displayVal = val * 100 + "%";
                    } else {
                        displayVal = '';
                    }
                } else if (type == 'number') {
                    displayVal = formatNumber(val);
                } else {
                    displayVal = val;
                }
                $(this).prev().text(displayVal)
                if (!val) val = '';
                temp.push(val);
            });
            construction.condominiums.push(temp);
        });
        google.script.run.withUserObject(this).withSuccessHandler(successSaveConstruction).saveConstruction(construction);
    });

    function successSaveLoans(data,button) {
        $(button).text("Save");
        $('#editLoanCancelBtn').click();
    }

    function successSaveExpenses(data,button) {
        $(button).text("Save");
        $('#editExpenseCancelBtn').click();
    }

    function successSaveRevenue(data,button) {
        $(button).text("Save");
        $('#editRevenueCancelBtn').click();
    }

    function successSaveConstruction(data,button) {
        $(button).text("Save");
        $('#editConstructionCancelBtn').click();
    }


    function formatNumber(number) {
        if (!number)return '';
        temp = Number(number);
        if (number < 1 && number > -1) return ''; // test for fractional numbers
        var formatted_value = temp.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,");
        return formatted_value;
    }



</script>