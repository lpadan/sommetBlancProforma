<?
var documentProperties = PropertiesService.getDocumentProperties();
var expenses = documentProperties.getProperty('expenses');

if (expenses) {
	expenses = JSON.parse(expenses);
} else {
	expenses = {};
	expenses.land = [];
	expenses.hardCosts = [];
	expenses.softCosts = [];
}
var softCosts = expenses.softCosts;
var hardCosts = expenses.hardCosts;
var land = expenses.land;

// console.log("softCosts = " + JSON.stringify(softCosts));

// expenses.softCosts = [
// 	["Alpha Soft Cost",'','','','','','',''],
// 	["Beta Soft Cost",'','','','','','',''],
// 	["Charlie Soft Cost",'','','','','','','']
// ]

// softCosts = expenses.softCosts;

// documentProperties.setProperty('expenses', JSON.stringify(expenses));

// expenses

	// ADD
	// all 3 categories below should be identical, other than variable names
	// could make generic and eliminate 2 of them

	// convert Land values to display values
		var displayLand = [];
		var displayValue = '';
		if (land.length) {
			for (var i = 0; i < land.length; i++) {
				displayLand[i] = [];
				for (var j = 0; j < 8; j++) {
					if (j == 1 || j == 2) {
						displayValue = formatNumber(land[i][j]);
					} else {
						displayValue = land[i][j];
					}
					displayLand[i].push(displayValue);
				}
			}
		} else {
			displayLand[0] = [];
			for (var j = 0; j < 8; j++) {
				displayLand[0].push('');
			}
		}

	// convert softCost values to display values
		var displaySoftCosts = [];
		var displayValue = '';

		if (softCosts.length) {
			for (var i = 0; i < softCosts.length; i++) {
				displaySoftCosts[i] = [];
				for (var j = 0; j < 8; j++) {
					if (j == 1 || j == 2) {
						displayValue = formatNumber(softCosts[i][j]);
					} else {
						displayValue = softCosts[i][j];
					}
					displaySoftCosts[i].push(displayValue);
				}
			}
		} else {
			displaySoftCosts[0] = [];
			for (var j = 0; j < 8; j++) {
				displaySoftCosts[0].push('');
			}
		}

	// convert hardCost values to display values
		var displayHardCosts = [];
		var displayValue = '';
		if (hardCosts.length) {
			for (var i = 0; i < hardCosts.length; i++) {
				displayHardCosts[i] = [];
				for (var j = 0; j < 8; j++) {
					if (j == 1 || j == 2) {
						displayValue = formatNumber(hardCosts[i][j]);
					} else {
						displayValue = hardCosts[i][j];
					}
					displayHardCosts[i].push(displayValue);
				}
			}
		} else {
			displayHardCosts[0] = [];
			for (var j = 0; j < 8; j++) {
				displayHardCosts[0].push('');
			}
		}

// revenue

	var revenue = documentProperties.getProperty('revenue');

	if (revenue) {
		revenue = JSON.parse(revenue);
	} else {
		revenue = {};
		revenue.sales = ['','','','',''];
		revenue.earnestMoney = [
			['','','',''],
			['','','',''],
			['','','','']
		];
		documentProperties.setProperty('revenue',JSON.stringify(revenue));
	}
	var runDate = revenue.runDate;
	var sales = revenue.sales;
	var earnestMoney = revenue.earnestMoney;
	var displayValue = '';

	// sales
	var displaySales = [];
	if (sales.length) {
		displaySales = [];
		for (var i = 0; i < sales.length; i++) {
			if (i == 3 || i == 4) {
				if (sales[i]) {
					displayValue = sales[i] * 100 + '%';
				} else {
					displayValue = '';
				}
			} else if (sales[i]) {
				displayValue = formatNumber(sales[i]);
			} else {
				displayValue = '';
			}
			displaySales.push(displayValue);
		}
	} else {
		for (var j = 0; j < 5; j++) {
			displaySales.push('');
		}
	}

	// earnest money
	var displayEarnestMoney = [];

	for (var i = 0; i < 3; i++) {
		displayEarnestMoney[i] = [];
		for (var j = 0; j < 5; j++) {
			var displayValue = '';
			// if (j == 0) {
			// 	displayValue = earnestMoney[i][0];
			// }
			if (j == 0) {
				if (earnestMoney[i][0]) {
					displayValue = earnestMoney[i][0] * 100 + '%';
				} else {
					displayValue = '';
				}
			}
			if (j > 0) {
				displayValue = earnestMoney[i][j];
			}
			displayEarnestMoney[i].push(displayValue);
		}

	}

// construction

	var construction = documentProperties.getProperty('construction');

	if (construction) {
		construction = JSON.parse(construction);
	} else {
		construction = {};
		construction.condominiums = ['','','',''];
		documentProperties.setProperty('construction',JSON.stringify(construction));
	}

	var condominiums = construction.condominiums;

	// condominiums
	var displayCondominiums = [];
	if (condominiums.length) {
		displayCondominiums = [];
		for (var i = 0; i < condominiums.length; i++) {
			if (i == 0) {
				displayValue = formatNumber(condominiums[i]);
			} else if (i == 1 || i == 2) {
				if (condominiums[i]) {
					displayValue = condominiums[i] * 100 + '%';
				} else {
					displayValue = '';
				}
			} else {
				displayValue = condominiums[i];
			}
			displayCondominiums.push(displayValue);
		}
	} else {
		for (var j = 0; j < 4; j++) {
			displayCondominiums.push('');
		}
	}

// loans

	var loans = documentProperties.getProperty('loans');

	if (loans) {
		loans = JSON.parse(loans);
	} else {
		loans = {};
		loans.acquisition = ['','','',''];
		loans.construction = ['','',''];
		loans.loanFees = [
			['','','','',''],
			['','','','',''],
			['','','','',''],
			['','','','',''],
			['','','','','']
		];
		documentProperties.setProperty('loans',JSON.stringify(loans));
	}

	var acquisition = loans.acquisition;
	var construction = loans.construction;
	var loanFees = loans.loanFees;
	var displayValue = '';

	// acquisition
	var displayAcquisition = [];
	if (acquisition.length) {
		displayAcquisition = [];
		for (var i = 0; i < acquisition.length; i++) {
			if (i == 0 || i == 2) {
				displayValue = formatNumber(acquisition[i]);
			}
			if (i == 1) {
				if (acquisition[i]) {
					displayValue = acquisition[i] * 100 + '%';
				} else {
					displayValue = '';
				}
			}
			displayAcquisition.push(displayValue);
		}
	} else {
		for (var j = 0; j < 3; j++) {
			displayAcquisition.push('');
		}
	}

	// construction
	var displayConstruction = [];
	if (construction.length) {
		displayConstruction = [];
		for (var i = 0; i < construction.length; i++) {

			if (i == 0) {
				displayValue = formatNumber(construction[i]);
			} else if (i == 1) {
				if (construction[i]) {
					displayValue = construction[i] * 100 + '%';
				} else {
					displayValue = '';
				}
			} else {
				if (!construction[i]) {
					displayValue = '';
				} else {
					displayValue = construction[i];
				}
			}
			displayConstruction.push(displayValue);
		}
	} else {
		for (var j = 0; j < 3; j++) {
			displayConstruction.push('');
		}
	}

	// loanFees
	var displayLoanFees = [];
	for (var i = 0; i < 4; i++) {
		displayLoanFees[i] = [];
		for (var j = 0; j < 5; j++) {
			var displayValue = '';
			if (j == 0) {
				if (loanFees[i][0]) {
					displayValue = loanFees[i][0] * 100 + '%';
				} else {
					displayValue = '';
				}
			} else if (j == 1) {
				if (loanFees[i][1]) {
					displayValue = formatNumber(loanFees[i][1]);
				} else {
					displayValue = '';
				}
			} else {
				if (loanFees[i][j]) {
					displayValue = loanFees[i][j];
				} else {
					displayValue = '';
				}
			}
			displayLoanFees[i].push(displayValue);
		}
	}

function formatNumber(number) {
    if (!number) return '';
    temp = Number(number);
    if (number < 1 && number > -1) return ''; // test for fractional numbers
    var formatted_value = temp.toString().replace(/(\d)(?=(\d\d\d)+(?!\d))/g, "$1,");
    return formatted_value;
}

?>

<!DOCTYPE html>
<html>

<head>
	<base target="_top">
	<link href='https://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700,300&amp;subset=latin,latin-ext' rel='stylesheet' type='text/css'>
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-rc.2/css/materialize.min.css">
	<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	<?!=include('SB.assumptions.css');?>
</head>

<body>

<div class="row">

  	<div class="col s12" style="padding:0">
  		<ul class="tabs">
  			<li class="tab col s2"><a class='active' href="#revenue">Revenue</a></li>
  			<li class="tab col s2"><a href="#construction">Construction</a></li>
  			<li class="tab col s2"><a href="#expense">Expenses</a></li>
  			<li class="tab col s2"><a href="#loans">Loans</a></li>
  		</ul>
  	</div>

    <div id="revenue" class="col s12">

    	<h5 style="margin-top:40px">Start Date</h5>
    	<section class='form-group'>

    		<ul class="form-fields">
    			<?
            	var html = `

                <li>
                    <label>Start Date</label>
                    <div style="flex:0 0 200px;display:block">
	                    <span style='display:inline-block;overflow:scroll;width:100%;text-align:left;padding-left:10px' class="revenue-display scrollable left">${runDate}</span>
	                    <input id="runDateInput" style='overflow:scroll;display:none;width:200px;padding-left:8px;text-align:left' type="text" placeholder="mmm yyyy" class="revenue-edit  run-date-revenue browser-default scrollable" value="${runDate}">
	                </div>
                </li>`;?>

                <?!= html; ?>

            </ul>
    	</section>

    	<h5 style="margin-top:40px">Sales</h5>

        <section id="revenueSales" class='form-group'>
            <ul class="form-fields">

            	<?
            	var html = `

                <li>
                    <label>Total Condo Sales</label>
                    <div style="flex:0 0 200px;display:block">
	                    <span style='display:inline-block;overflow:scroll;width:100%;text-align:left;padding-left:10px' class="revenue-display scrollable left">${displaySales[0]}</span>
	                    <input style='overflow:scroll;display:none;width:200px;padding-left:8px;text-align:left' type="number" class="revenue-edit  sales-revenue browser-default scrollable" value="${sales[0]}">
	                </div>
                </li>

                <li>
                    <label>Condo Pre-Sales</label>
                    <div style="flex:0 0 200px;display:block">
                    	<span style='display:inline-block;overflow:scroll;width:100%;text-align:left;padding-left:10px' class="revenue-display scrollable left">${displaySales[1]}</span>
                    	<input style='overflow:scroll;display:none;width:200px;padding-left:8px;text-align:left' type="number" class="sales-revenue revenue-edit browser-default scrollable" value="${sales[1]}">
                    </div>
                </li>

                <li>
                    <label>Condo Sales/Month</label>
	                <div style="flex:0 0 200px;display:block">
	                    <span style='display:inline-block;overflow:scroll;width:100%;text-align:left;padding-left:10px' class="revenue-display scrollable left">${displaySales[2]}</span>
	                    <input style='overflow:scroll;display:none;width:200px;padding-left:8px;text-align:left' type="number" class="sales-revenue revenue-edit browser-default scrollable" value="${sales[2]}">
	                </div>
                </li>

                <li>
                    <label>Listing Commission</label>
	                <div style="flex:0 0 200px;display:block">
	                    <span style='display:inline-block;overflow:scroll;width:100%;text-align:left;padding-left:10px' class="revenue-display scrollable left">${displaySales[3]}</span>
	                    <input style='overflow:scroll;display:none;width:200px;padding-left:8px;text-align:left' type="number" data-percent=1 class="sales-revenue revenue-edit browser-default scrollable" value="${sales[3]}">
	                </div>
                </li>

                <li>
                    <label>Selling Commission</label>
	                <div style="flex:0 0 200px;display:block">
	                    <span style='display:inline-block;overflow:scroll;width:100%;text-align:left;padding-left:10px' class="revenue-display scrollable left">${displaySales[4]}</span>
	                    <input style='overflow:scroll;display:none;width:200px;padding-left:8px;text-align:left' type="number" data-percent=1 class="sales-revenue revenue-edit browser-default scrollable" value="${sales[4]}">
	                </div>
	            </li>`;?>

	            <?!= html; ?>

            </ul>
        </section>

        <div style="display:flex;background-color: white;">
            <h5 style="flex:0 0 200px">Earnest Money</h5>
            <h5 style="flex:0 0 90px;text-align:center">%</h5>
            <h5 style="flex:0 0 90px;text-align:center">Date</h5>
            <h5 style="flex:0 0 110px;text-align:center">Milestone</h5>
            <h5 style="flex:0 0 110px;text-align:center">Start/Finish</h5>
        </div>

        <section id="revenueEarnestMoney" class="form-group">

            <ul class="form-fields">
            	<?

            	var label = ['First EM Deposit','Second EM Deposit', 'Third EM Deposit'];
            	for (var i = 0; i < 3; i++) {

 					var html = `

	                <li>
	                    <label style="flex:0 0 200px">${label[i]}</label>

	                    <div style="flex:0 0 90px;display:block">
		                    <span style="display: block"  class="revenue-display scrollable">${displayEarnestMoney[i][0]}</span>
		                    <input style="display:none" type="number" class="earnest-money-revenue revenue-edit browser-default scrollable" data-percent=1 value="${earnestMoney[i][0]}">
		                </div>

	                    <div style="flex:0 0 90px;display:block">
	                    	<span style="display: block"  class="revenue-display scrollable">${displayEarnestMoney[i][1]}</span>
	                    	<input style="display:none" type="text" placeholder="mmm yyyy" class="earnest-money-revenue revenue-edit browser-default scrollable" value="${earnestMoney[i][1]}">
	                    </div>

		                <div style="flex:0 0 110px;display:block">
		                    <span style="display: block"  class="revenue-display scrollable">${displayEarnestMoney[i][2]}</span>
		                    <input style="display:none" type="text" class="earnest-money-revenue revenue-edit browser-default scrollable" value="${earnestMoney[i][2]}">
		                </div>

		                <div style="flex:0 0 110px;display:block">
	                    	<span style="display: block"  class="revenue-display scrollable">${displayEarnestMoney[i][3]}</span>
		                    <select class="earnest-money-revenue browser-default revenue-edit" style="display:none">`;

			                if (!earnestMoney[i][3]) {
			                    html += `<option value="">choose</option>
			                    		 <option value="finish">finish</option>
			                    		 <option value="start">start</option>`
				            } else if (earnestMoney[i][3] == 'finish') {
				            	html += `<option value="">choose</option>
			                    		 <option value="finish" selected>finish</option>
			                    		 <option value="start">start</option>`
				            } else if (earnestMoney[i][3] == 'start') {
				            	html += `<option value="">choose</option>
			                    		 <option value="finish">finish</option>
			                    		 <option value="start" selected>start</option>`
				            }
				            html += `

		                    </select>
		                </div>
	                </li>

	                `; ?>

					<?!= html; ?><?

            	} ?>

            </ul>
        </section>

	    <div id="displayRevenueBtns" style="position:fixed;bottom:0;left:0px;width:100%">
            <a class="waves-effect waves-light btn-flat" onclick='google.script.host.close()'>Close</a>
            <a id="editRevenueBtn" style="background-color:#4889f1" class="waves-effect waves-light btn">Edit</a>
        </div>

        <div id="editRevenueBtns" style="position:fixed;bottom:0;left:0px;width:100%;display:none">
            <a id="editRevenueCancelBtn" class="waves-effect waves-light btn-flat">Cancel</a>
            <a id="editRevenueSaveBtn" style="background-color:#4889f1" class="waves-effect waves-light btn">Save</a>
        </div>
    </div>

    <div id="construction" style="width:600px" class="col s12">

    	<h5 style="margin-top:40px">Condominiums</h5>

        <section id="constructionCondominiums" class='form-group'>

            <ul class="form-fields">

            	<?
            	var html = `

                <li>
                    <label style="flex:0 0 200px">Construction Cost</label>

	                <div style="flex:0 0 200px;display:block">
	                    <span style='display:inline-block;overflow:scroll;width:100%;text-align:left;padding-left:10px' class="construction-display scrollable left">${displayCondominiums[0]}</span>
	                    <input style='overflow:scroll;display:none;width:200px;padding-left:8px;text-align:left' type="number" class="condominiums-construction construction-edit browser-default scrollable" value="${condominiums[0]}">
	                </div>
                </li>

                <li>
                    <label style="flex:0 0 200px;display:block">Contingency</label>
	                <div style="flex:0 0 200px;display:block">
	                    <span style='display:inline-block;overflow:scroll;width:100%;text-align:left;padding-left:10px' class="construction-display scrollable left">${displayCondominiums[1]}</span>
	                    <input style='overflow:scroll;display:none;width:200px;padding-left:8px;text-align:left' type="text" class="construction-edit browser-default condominiums-construction scrollable" data-percent=1 value="${condominiums[1]}">
	                </div>
                </li>

                <li>
                    <label style="flex:0 0 200px;display:block">Construction Mgmt</label>
	                <div style="flex:0 0 200px;display:block">
	                    <span style='display:inline-block;overflow:scroll;width:100%;text-align:left;padding-left:10px'class="construction-display scrollable left">${displayCondominiums[2]}</span>
	                    <input style='overflow:scroll;display:none;width:200px;padding-left:8px;text-align:left' type="number" class="construction-edit browser-default condominiums-construction scrollable" data-percent=1 value="${condominiums[2]}">
	                </div>
                </li>

                <li>
                    <label style="flex:0 0 200px;display:block">Schedule Tab Name</label>
	                <div style="flex:0 0 200px;display:block">
	                    <span style='display:inline-block;overflow:scroll;width:100%;text-align:left;padding-left:10px' class="construction-display scrollable left">${displayCondominiums[3]}</span>
	                    <input style='overflow:scroll;display:none;width:200px;padding-left:8px;text-align:left' type="text" class="construction-edit browser-default condominiums-construction scrollable" value="${condominiums[3]}">
	                </div>
                </li>`;?>

                <?!= html; ?>

            </ul>
        </section>

        <div id="displayConstructionBtns" style="position:fixed;bottom:0;left:0px;width:100%">
            <a class="waves-effect waves-light btn-flat" onclick='google.script.host.close()'>Close</a>
            <a id="editConstructionBtn" style="background-color:#4889f1" class="waves-effect waves-light btn">Edit</a>
        </div>

        <div id="editConstructionBtns" style="position:fixed;bottom:0;left:0px;width:100%;display:none">
            <a id="editConstructionCancelBtn" class="waves-effect waves-light btn-flat">Cancel</a>
            <a id="editConstructionSaveBtn" style="background-color:#4889f1" class="waves-effect waves-light btn">Save</a>
        </div>
    </div>

    <div id="loans" style="width:800px" class="col s12">

    	<h5 style="margin-top:40px">Acquisition Loan</h5>
        <section id="loansAcquisition" style="width:600px" class='form-group'>
            <ul class="form-fields">

            	<?
            	var html = `
                <li>
                    <label style="flex:0 0 200px">Current Balance</label>

	                <div style="flex:0 0 200px;display:block">
	                    <span style='display:inline-block;overflow:scroll;width:100%;text-align:left;padding-left:10px' class="loan-display scrollable left">${displayAcquisition[0]}</span>
	                    <input style='overflow:scroll;display:none;width:200px;padding-left:8px;text-align:left' type="number" class="loan-edit browser-default scrollable acquisition-loans" value="${acquisition[0]}">
	                </div>
                </li>

                <li>
                    <label style="flex:0 0 200px">Interest Rate</label>
	                <div style="flex:0 0 200px;display:block">
	                    <span style='display:inline-block;overflow:scroll;width:100%;text-align:left;padding-left:10px' class="loan-display scrollable left">${displayAcquisition[1]}</span>
	                    <input style='overflow:scroll;display:none;width:200px;padding-left:8px;text-align:left' type="text" class="loan-edit browser-default scrollable acquisition-loans" data-percent=1 value="${acquisition[1]}">
	                </div>
                </li>

                <li>
                    <label style="flex:0 0 200px">Interest Paid to Date</label>
	                <div style="flex:0 0 200px;display:block">
	                    <span style='display:inline-block;overflow:scroll;width:100%;text-align:left;padding-left:10px' class="loan-display scrollable left">${displayAcquisition[2]}</span>
	                    <input style='overflow:scroll;display:none;width:200px;padding-left:8px;text-align:left' type="number" class="loan-edit browser-default scrollable acquisition-loans" value="${acquisition[2]}">
	                </div>
                </li>`; ?>

                <?!= html; ?>

            </ul>
        </section>

        <h5 style="margin-top:40px">Construction Loan</h5>
        <section id="loansConstruction" style="width:600px" class="form-group">
            <ul class="form-fields">

            	<?
            	var html = `

                <li>
                    <label style="flex:0 0 200px">Estimated Loan Amount</label>
	                <div style="flex:0 0 200px;display:block">
	                    <span style='display:inline-block;overflow:scroll;width:100%;text-align:left;padding-left:10px' class="loan-display scrollable left">${displayConstruction[0]}</span>
	                    <input style='overflow:scroll;display:none;width:200px;padding-left:8px;text-align:left' type="number" class="loan-edit browser-default scrollable construction-loans" value="${construction[0]}">
	                </div>
                </li>

                <li>
                    <label style="flex:0 0 200px">Interest Rate</label>
	                <div style="flex:0 0 200px;display:block">
	                    <span style='display:inline-block;overflow:scroll;width:100%;text-align:left;padding-left:10px' class="loan-display scrollable left">${displayConstruction[1]}</span>
	                    <input style='overflow:scroll;display:none;width:200px;padding-left:8px;text-align:left' type="text" class="loan-edit browser-default scrollable construction-loans" data-percent=1 value="${construction[1]}">
	                </div>
                </li>

                <li>
                    <label style="flex:0 0 200px">Start Date</label>
	                <div style="flex:0 0 200px;display:block">
	                    <span style='display:inline-block;overflow:scroll;width:100%;text-align:left;padding-left:10px' class="loan-display scrollable left">${displayConstruction[2]}</span>
	                    <input style='overflow:scroll;display:none;width:200px;padding-left:8px;text-align:left' type="text" class="loan-edit browser-default scrollable construction-loans" value="${construction[2]}">
	                </div>
                </li>`;?>

                <?!= html; ?>

            </ul>
        </section>

        <div style="display:flex;flex-wrap:wrap">
            <h5 style="flex:0 0 200px">Loan Fees</h5>
            <h5 style="flex:0 0 90px;text-align:center">%</h5>
            <h5 style="flex:0 0 110px;text-align:center">Lump Sum</h5>
            <h5 style="flex:0 0 90px;text-align:center">Date</h5>
            <h5 style="flex:0 0 110px;text-align:center">Milestone</h5>
            <h5 style="flex:0 0 110px;text-align:center">Start/Finish</h5>
        </div>

        <section id="loansFees" class="form-group">
            <ul class="form-fields">

            	<?
            	var label = ['Broker Fee','Origination Fee', 'Closeout Fee', 'Legal'];
            	for (var i = 0; i < 4; i++) {
	            	html = `
	                <li>
	                    <label style="flex:0 0 200px" class="label">${label[i]}</label>

	                    <div style="flex:0 0 90px;display:block">
		                    <span style="display: block" class="loan-display scrollable">${displayLoanFees[i][0]}</span>
		                    <input style="display:none" type="text" class="loan-edit browser-default scrollable fees-loans" data-percent=1 value="${loanFees[i][0]}">
		                </div>

		                <div style="flex:0 0 110px;display:block">
		                    <span style="display: block" class="loan-display scrollable">${displayLoanFees[i][1]}</span>
		                    <input style="display:none" type="number" class="loan-edit browser-default scrollable fees-loans" value="${loanFees[i][1]}">
		                </div>

		                <div style="flex:0 0 90px;display:block">
		                    <span style="display: block" class="loan-display scrollable">${displayLoanFees[i][2]}</span>
		                    <input style="display:none" type="text" placeholder="mmm yyyy" data-date=1 class="loan-edit browser-default scrollable fees-loans" value="${loanFees[i][2]}">
		                </div>

		                <div style="flex:0 0 110px;display:block">
		                    <span style="display: block" class="loan-display scrollable">${displayLoanFees[i][3]}</span>
		                    <input style="display:none" type="text" class="loan-edit browser-default scrollable fees-loans" value="${loanFees[i][3]}">
		                </div>

		                <div style="flex:0 0 110px;display:block">
	                    	<span style="display: block" class="loan-display scrollable">${displayLoanFees[i][4]}</span>
		                    <select class="browser-default loan-edit fees-loans" style="display:none">`;

		                    if (!loanFees[i][4]) {
			                    html += `<option value="">choose</option>
			                    		 <option value="finish">finish</option>
			                    		 <option value="start">start</option>`
				            } else if (loanFees[i][4] == 'finish') {
				            	html += `<option value="">choose</option>
			                    		 <option value="finish" selected>finish</option>
			                    		 <option value="start">start</option>`
				            } else if (loanFees[i][4] == 'start') {
				            	html += `<option value="">choose</option>
			                    		 <option value="finish">finish</option>
			                    		 <option value="start" selected>start</option>`
				            }
				            html += `

		                    </select>
		                </div>
	                </li>`;?>

                <?!= html; ?><?
            } ?>

            </ul>
        </section>

	    <div id="displayLoanBtns" style="position:fixed;bottom:0;left:0px;width:100%">
            <a class="waves-effect waves-light btn-flat" onclick='google.script.host.close()'>Close</a>
            <a id="editLoanBtn" style="background-color:#4889f1" class="waves-effect waves-light btn">Edit</a>
        </div>

        <div id="editLoanBtns" style="position:fixed;bottom:0;left:0px;width:100%;display:none">
            <a id="editLoanCancelBtn" class="waves-effect waves-light btn-flat">Cancel</a>
            <a id="editLoanSaveBtn" style="background-color:#4889f1" class="waves-effect waves-light btn">Save</a>
        </div>
    </div>

	<div id="expense" style="width: 1000px" class="col s12">

    	<div class="expense-header" style="display:flex;margin-top:15px">
            <h5 style="flex:0 0 200px"></h5>
            <h5 style="flex:0 0 110px;text-align:center">Paid</h5>
            <h5 style="flex:0 0 110px;text-align:center">Future</h5>
            <h5 style="flex:0 0 110px;text-align:center">Type</h5>
            <h5 style="flex:0 0 90px;text-align:center">Start</h5>
            <h5 style="flex:0 0 110px;text-align:center">Milestone</h5>
            <h5 style="flex:0 0 110px;text-align:center">Start/Finish</h5>
            <h5 style="flex:0 0 90px;text-align:center">Duration</h5>
        </div>

        <div style="height:525px;overflow-y: scroll;">

	    	<h5 style="margin-top:10px">Land</h5>
	    	<section class="form-group">
	            <ul id="land" class="form-fields">

	            	<?
	            	for (var i = 0; i < land.length; i++) {
	 					var html = `

		 				<li>

		                	<div style="flex:0 0 200px;display:block">
		                    	<span style="display: block" class="expense-display label" name="description">${land[i][0]}</span>
		                    	<input style="display:none;text-align: right;min-width:200px" type="text" name="description" class="expense-edit land-expense browser-default scrollable label" value="${land[i][0]}">
		                    </div>

		                    <div style='overflow:scroll; display:block;flex:0 0 110px;text-align:center'>
			                    <span style="display:block" class="expense-display scrollable" name="paid">${displayLand[i][1]}</span>
			                    <input style='display:none' type="number" class="expense-edit land-expense browser-default scrollable" name="paid" value="${land[i][1]}">
			                </div>

			                <div style='overflow:scroll; display:block;flex:0 0 110px;text-align:center'>
			                    <span style='display:block;text-align:center' class="expense-display scrollable" name="future">${displayLand[i][2]}</span>
			                    <input style='overflow:scroll; display:none;text-align:center' type="number" class="expense-edit land-expense browser-default scrollable" name="future" value="${land[i][2]}">
			                </div>

			                <div style='overflow:scroll; display:block;flex:0 0 110px;text-align:center'>
			                    <span style='overflow:scroll; display:block;text-align:center' class="expense-display scrollable" name="type">${land[i][3]}</span>
			                    	<select style="display: none" class="browser-default expense-edit land-expense" name="type">`;

					                if (!land[i][3]) {
					                    html += `<option value="">choose</option>
					                    		 <option value="lump sum">lump sum</option>
					                    		 <option value="monthly">monthly</option>`
						            } else if (land[i][3] == 'lump sum') {
						            	html += `<option value="">choose</option>
					                    		 <option value="lump sum" selected>lump sum</option>
					                    		 <option value="monthly">monthly</option>`
						            } else if (land[i][3] == 'monthly') {
						            	html += `<option value="">choose</option>
					                    		 <option value="lump sum">lump sum</option>
					                    		 <option value="monthly" selected>monthly</option>`
						            }
					            	html +=`

					            	</select>
					            </div>

				            <div style='overflow:scroll; display:block;flex:0 0 90px;text-align:center'>
			                    <span style='overflow:scroll; display:block;text-align:center' class="expense-display scrollable" name="start">${land[i][4]}</span>
			                    <input style='overflow:scroll; display:none;text-align:center' type="text" class="expense-edit land-expense browser-default scrollable" name="start" placeholder="mmm yyyy" value="${land[i][4]}">
			                </div>

			                <div style='overflow:scroll; display:inline-block;flex:0 0 110px;text-align:center'>
			                    <span style='overflow:scroll; display:block;text-align:center' class="expense-display scrollable" name="milestone">${land[i][5]}</span>
			                    <input style='overflow:scroll; display:none;text-align:center' type="text" class="expense-edit land-expense browser-default scrollable" name="milestone" value="${land[i][5]}">
			                </div>

			                <div style='overflow:scroll;display: block;flex:0 0 110px;text-align:center'>
			                    <span style='overflow:scroll; display:block;text-align:center' class="expense-display scrollable" name="startFinish">${land[i][6]}</span>
			                    <select style="display: none" class="browser-default expense-edit land-expense" name="startFinish">`;

			                	if (!land[i][6]) {
				                    html += `<option value="">choose</option>
				                    		 <option value="finish">finish</option>
				                    		 <option value="start">start</option>`
					            } else if (land[i][6] == 'finish') {
					            	html += `<option value="">choose</option>
				                    		 <option value="finish" selected>finish</option>
				                    		 <option value="start">start</option>`
					            } else if (land[i][6] == 'start') {
					            	html += `<option value="">choose</option>
				                    		 <option value="finish">finish</option>
				                    		 <option value="start" selected>start</option>`
					            }
				            	html += `

			                    </select>
				            </div>

				            <div style='overflow:scroll; display:inline-block;flex:0 0 90px;text-align:center'>
			                    <span style='overflow:scroll; display:block;text-align:center' class="expense-display scrollable" name="duration">${land[i][7]}</span>
				                <input style='overflow:scroll; display:none;text-align:center' type="text" class="expense-edit land-expense browser-default scrollable" name="duration" value="${land[i][7]}">
				            </div>
		                </li>

						`; ?>

						<?!= html; ?><?

	            	} ?>
	            </ul>
	        </section>

	        <h5 style="margin-top:0">Hard Costs</h5>
	        <section class="form-group">
	            <ul id="hardCosts" class="form-fields">

	            	<?
	            	for (var i = 0; i < hardCosts.length; i++) {
	 					var html = `

	                <li>
	                	<div style="flex:0 0 200px;display:block">
		                    <span style="display: block" class="expense-display label" name="description">${hardCosts[i][0]}</span>
		                    <input style="display:none;text-align: right;min-width:200px" type="text" class="expense-edit hard-cost-expense browser-default scrollable label" name="description" value="${hardCosts[i][0]}">
		                </div>

		                <div style='overflow:scroll; display:block;flex:0 0 110px;text-align:center'>
		                    <span style="display:block" class="expense-display scrollable" name="paid">${displayHardCosts[i][1]}</span>
		                    <input style='display:none' type="number" class="expense-edit hard-cost-expense browser-default scrollable" name="paid" value="${hardCosts[i][1]}">
		                </div>


		                <div style='overflow:scroll; display:block;flex:0 0 110px;text-align:center'>
		                    <span style="display:block" class="expense-display scrollable" name="future">${displayHardCosts[i][2]}</span>
		                     <input style='display:none' type="number" class="expense-edit hard-cost-expense browser-default scrollable" name="future" value="${hardCosts[i][2]}">
		                </div>

		                <div style='overflow:scroll; display:block;flex:0 0 110px;text-align:center'>
		                    <span style='overflow:scroll; display:block;text-align:center' class="expense-display scrollable" name="type">${hardCosts[i][3]}</span>
		                    <select style="display: none" class="browser-default hard-cost-expense expense-edit" name="type">`;

			                if (!hardCosts[i][3]) {
			                    html += `<option value="">choose</option>
			                    		 <option value="lump sum">lump sum</option>
			                    		 <option value="monthly">monthly</option>`
				            } else if (hardCosts[i][3] == 'lump sum') {
				            	html += `<option value="">choose</option>
			                    		 <option value="lump sum" selected>lump sum</option>
			                    		 <option value="monthly">monthly</option>`
				            } else if (hardCosts[i][3] == 'monthly') {
				            	html += `<option value="">choose</option>
			                    		 <option value="lump sum">lump sum</option>
			                    		 <option value="monthly" selected>monthly</option>`
				            }

				            html += `

		                    </select>
		                </div>

		                <div style='overflow:scroll; display:block;flex:0 0 90px;text-align:center'>
		                    <span style='overflow:scroll; display:block;text-align:center' class="expense-display scrollable" name="start">${hardCosts[i][4]}</span>
		                    <input style='overflow:scroll; display:none;text-align:center;flex:1 0 90px' type="text" class="expense-edit hard-cost-expense browser-default scrollable" placeholder="mmm yyyy" name="start" value="${hardCosts[i][4]}">
		                </div>

		                <div style='overflow:scroll; display:inline-block;flex:0 0 110px;text-align:center'>
		                    <span style='overflow:scroll; display:block;text-align:center' class="expense-display scrollable" name="milestone">${hardCosts[i][5]}</span>
		                    <input style='overflow:scroll; display:none;text-align:center' type="text" class="expense-edit hard-cost-expense browser-default scrollable" name="milestone" value="${hardCosts[i][5]}">
		                </div>

		                <div style='overflow:scroll;display: block;flex:0 0 110px;text-align:center'>
		                    <span style='overflow:scroll; display:block;text-align:center' class="expense-display scrollable" name="startFinish">${hardCosts[i][6]}</span>
		                    <select style="display: none" class="browser-default hard-cost-expense expense-edit land-expense" name="startFinish">`;

			                if (!hardCosts[i][6]) {
			                    html += `<option value="">choose</option>
			                    		 <option value="finish">finish</option>
			                    		 <option value="start">start</option>`
				            } else if (hardCosts[i][6] == 'finish') {
				            	html += `<option value="">choose</option>
			                    		 <option value="finish" selected>finish</option>
			                    		 <option value="start">start</option>`
				            } else if (hardCosts[i][6] == 'start') {
				            	html += `<option value="">choose</option>
			                    		 <option value="finish">finish</option>
			                    		 <option value="start" selected>start</option>`
				            }

				            html += `

		                    </select>
		                </div>

		                <div style='overflow:scroll; display:inline-block;flex:0 0 90px;text-align:center'>
		                    <span style='overflow:scroll; display:block;text-align:center' class="expense-display scrollable" name="duration">${hardCosts[i][7]}</span>
			                <input style='overflow:scroll; display:none;text-align:center' type="text" class="expense-edit hard-cost-expense browser-default scrollable" name="duration" value="${hardCosts[i][7]}">
			            </div>
	                </li>
	                `; ?>

						<?!= html; ?><?

	            	} ?>
	            </ul>
	        </section>

	        <h5 style="margin-top:0">Soft Costs</h5>
	        <section class="form-group">
	            <ul id="softCosts" class="form-fields">

	            	<?
	            	for (var i = 0; i < softCosts.length; i++) {
	 					var html = `

	            	<li>
	                	<div style="flex:0 0 200px;display:block">
		                    <span style="display: block" class="expense-display label" name="description">${softCosts[i][0]}</span>
		                    <input style="display:none;text-align: right;min-width:200px" type="text" class="expense-edit soft-cost-expense browser-default scrollable label" name="description" value="${softCosts[i][0]}">
		                </div>

		                <div style='overflow:scroll; display:block;flex:0 0 110px;text-align:center'>
		                    <span style="display:block" class="expense-display scrollable" name="paid">${displaySoftCosts[i][1]}</span>
		                    <input style='display:none' type="number" class="expense-edit soft-cost-expense browser-default scrollable" name="paid" value="${softCosts[i][1]}">
		                </div>


		                <div style='overflow:scroll; display:block;flex:0 0 110px;text-align:center'>
		                    <span style="display:block" class="expense-display scrollable" name="future">${displaySoftCosts[i][2]}</span>
		                     <input style='display:none' type="number" class="expense-edit soft-cost-expense browser-default scrollable" name="future" value="${softCosts[i][2]}">
		                </div>

		                <div style='overflow:scroll; display:block;flex:0 0 110px;text-align:center'>
		                    <span style='overflow:scroll; display:block;text-align:center' class="expense-display scrollable" name="type">${softCosts[i][3]}</span>
		                    <select style="display: none" class="browser-default soft-cost-expense expense-edit" name="type">`;

			                if (!softCosts[i][3]) {
			                    html += `<option value="">choose</option>
			                    		 <option value="lump sum">lump sum</option>
			                    		 <option value="monthly">monthly</option>`
				            } else if (softCosts[i][3] == 'lump sum') {
				            	html += `<option value="">choose</option>
			                    		 <option value="lump sum" selected>lump sum</option>
			                   			 <option value="monthly">monthly</option>`
				            } else if (softCosts[i][3] == 'monthly') {
				            	html += `<option value="">choose</option>
			                    		 <option value="lump sum">lump sum</option>
			                    		 <option value="monthly" selected>monthly</option>`
				            }

				            html += `

		                    </select>
		                </div>

		                <div style='overflow:scroll; display:block;flex:0 0 90px;text-align:center'>
		                    <span style='overflow:scroll; display:block;text-align:center' class="expense-display scrollable" name="start">${softCosts[i][4]}</span>
		                    <input style='overflow:scroll; display:none;text-align:center;flex:1 0 90px' type="text" class="expense-edit soft-cost-expense browser-default scrollable" placeholder="mmm yyyy" name="start" value="${softCosts[i][4]}">
		                </div>

		                <div style='overflow:scroll; display:inline-block;flex:0 0 110px;text-align:center'>
		                    <span style='overflow:scroll; display:block;text-align:center' class="expense-display scrollable" name="milestone">${softCosts[i][5]}</span>
		                    <input style='overflow:scroll; display:none;text-align:center' type="text" class="expense-edit soft-cost-expense browser-default scrollable" name="milestone" value="${softCosts[i][5]}">
		                </div>

		                <div style='overflow:scroll;display: block;flex:0 0 110px;text-align:center'>
		                    <span style='overflow:scroll; display:block;text-align:center' class="expense-display scrollable" name="startFinish">${softCosts[i][6]}</span>
		                    <select style="display: none" class="browser-default soft-cost-expense expense-edit" name="startFinish">`;

			                if (!softCosts[i][6]) {
			                    html += `<option value="">choose</option>
			                    		 <option value="finish">finish</option>
			                    		 <option value="start">start</option>`
				            } else if (softCosts[i][6] == 'finish') {
				            	html += `<option value="">choose</option>
			                    		 <option value="finish" selected>finish</option>
			                    		 <option value="start">start</option>`
				            } else if (softCosts[i][6] == 'start') {
				            	html += `<option value="">choose</option>
			                    		 <option value="finish">finish</option>
			                    		 <option value="start" selected>start</option>`
				            }

				            html += `

		                    </select>
		                </div>

		                <div style='overflow:scroll; display:inline-block;flex:0 0 90px;text-align:center'>
		                    <span style='overflow:scroll; display:block;text-align:center' class="expense-display scrollable" name="duration">${softCosts[i][7]}</span>
			                <input style='overflow:scroll; display:none;text-align:center' type="text" class="expense-edit soft-cost-expense browser-default scrollable" name="duration" value="${softCosts[i][7]}">
			            </div>
	                </li>

	                `; ?>

					<?!= html; ?><?

	            	} ?>

	            </ul>
	        </section>

	    </div>

        <div id="displayExpenseBtns" style="position:fixed;bottom:0;left:0px;width:100%">
            <a id="addExpenseBtn" style="background-color:#4889f1" class="waves-effect waves-light btn">Add</a>
            <a id="editExpenseBtn" style="background-color:#4889f1;margin-left:10px" class="waves-effect waves-light btn">Edit</a>
            <a id="deleteExpenseBtn" style="background-color:#4889f1;margin-left:10px" class="waves-effect waves-light btn">Delete</a>
        </div>

        <div id="editExpenseBtns" style="position:fixed;bottom:0;left:0px;width:100%;display:none">
            <a id="editExpenseCancelBtn" class="waves-effect waves-light btn-flat">Cancel</a>
            <a id="editExpenseSaveBtn" style="background-color:#4889f1" class="waves-effect waves-light btn">Save</a>
        </div>
    </div>

</div>

<div id="addExpenseModal" style="width:700px;height:400px" class="modal modal-fixed-footer" >
	<div class="modal-content">
		<h5 style="margin-top:0;margin-bottom:20px">Add Expense</h5>

		<form id='addExpenseForm'>

			<div style="display:flex;margin-top:40px">

				<div style="flex:33%;margin:0 20px 0 20px">

					<div class="input-field" >
						<select class="" name="category">
							<option value="">choose</option>
							<option value="land">Land</option>
							<option value="hardCosts">Hard Cost</option>
							<option value="softCosts">Soft Cost</option>
						</select>
						<label>Expense Category</label>
					</div>

					<div class="input-field" style="margin-top: 23px;">
			          	<input id="description" type="text" class="" name="description">
			          	<label for="description">Description</label>
			        </div>


					<div class="input-field" style="margin-top:16px">
			          	<input id="paid" type="number" class="" name="paidCosts">
			          	<label for="paid">Paid Costs</label>
			        </div>

				</div>


				<div style="flex:33%;margin:0 20px 0 20px">

					<div class="input-field">
			          	<input id="future" type="number" class="" name="futureCosts">
			          	<label for="future">Future Costs</label>
			        </div>

			        <div class="input-field">
						<select class="" name="type">
							<option value="">choose</option>
							<option value="lump sum">Lump Sum</option>
							<option value="monthly">Monthly</option>
						</select>
						<label>Type</label>
					</div>

					<div class="input-field" style="margin-top:22px">
						<input id="startDate" type="text" placeholder="mmm yyyy" name="startDate">
						<label for="startDate">Start Date</label>
					</div>


				</div>


				<div style="flex:33%;margin:0 20px 0 20px">

					<div class="input-field">
			          	<input id="milestone" type="text" class="" name="milestone">
			          	<label for="milestone">Milestone</label>
			        </div>

			        <div class="input-field">
						<select class="" name="startFinish">
							<option value="">choose</option>
							<option value="start">Start</option>
							<option value="finish">Finish</option>
						</select>
						<label>Start/Finish</label>
					</div>

					<div class="input-field" style="margin-top:22px">
			          	<input id="duration" type="number" class="" name="duration">
			          	<label for="duration">Duration</label>
			        </div>

			    </div>

			</div>

		</form>


	</div>
	<div class="modal-footer" style="margin-bottom:20px;padding:15px">
		<a data-value="cancel" class="modal-close waves-effect waves-light btn-flat">Cancel</a>
        <a id="addExpenseSaveBtn" style="background-color:#4889f1" class="waves-effect waves-light btn">Add</a>
	</div>

	<div id="userInput" data-userinput="" hidden></div>
</div>

<div id="deleteExpenseModal" class="modal modal-fixed-footer" style="max-height:250px">
	<div class="modal-content">
		<h5 style="margin-top:0;margin-bottom:20px">Delete Expense</h5>

		<div style="display:flex;font-size:16px">

			<div style="width:200px;flex:1;padding:0 15px 0 15px">
				<label>Category</label>
				<select id="expenseCategory" class="browser-default">
					<option value="">choose</option>
					<option value="land">Land</option>
					<option value="hardCosts">Hard Costs</option>
					<option value="softCosts">Soft Costs</option>
				</select>

			</div>

			<div style="width:200px;flex:1;padding:0 15px 0 15px">
				<label>Line Item</label>
				<select id="expenseItem" class="browser-default">
					<option>choose Item</option>
				</select>
			</div>

		</div>


	</div>
	<div class="modal-footer" style="margin-bottom:20px;padding:15px">
		<a data-value="cancel" class="modal-close waves-effect btn-flat">Cancel</a>
		<a id="deleteExpenseDeleteBtn" style="background-color:#4889f1" class="waves-effect waves-light btn">Delete</a>
	</div>

	<div id="userInput" data-userinput="" hidden></div>
</div>

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0-rc.2/js/materialize.min.js"></script>

<?!=include('SB.assumptions.js');?>

<script>

	$('select').formSelect();
	//$('.datepicker').datepicker();

	var datePicker = document.querySelectorAll('.datepicker');
    M.Datepicker.init(datePicker, {container:"body"});

	var addOptions = {
		startingTop:'5%',
		endingTop:'20%',
		opacity:.3,
		dismissable:true,
		container:"body"
	}

	var deleteOptions = {
		startingTop:'20%', // where it starts
		endingTop: '30%', // where it ends (starts at top seeting, and transitions to here)
		opacity:.3,
		dismissable:true,
	}
	var elem = document.getElementById('addExpenseModal');
	var elem2 = document.getElementById('deleteExpenseModal');
	var addExpenseModal = M.Modal.init(elem, addOptions);
	var deleteExpenseModal = M.Modal.init(elem2, deleteOptions);
</script>

</body>
</html>
